# 뷰모델

- 뷰모델을 사용하려면 jetpack lifecycle-extensions 을 의존성에 추가해야한다.


- 뷰모델이란?
  - 뷰모델은 특정 액티비티 화면과 연동된다.
  - 해당 화면에 보여줄 데이터를 형식화하는 로직을 두기 좋은 곳
  - 뷰모델은 모델 객체와 연동되어 모델을 장식한다.
    - 모델 데이터를 화면에 보여주는 기능을 뷰모델이 수행한다.
  - 화면에 필요한 모든 데이터를 한 곳에서 종합하고 데이터를 형식화 할 수 있다.


- 사용
  - `onCreate()`에서 현재 액티비티를 뷰모델 인스턴스와 연결한다.
  - `ViewModelProvider(this)`를 호출하면 현재 액티비티와 연관된 `ViewModelProvider`인스턴스를 생성하고 반환한다.
  - `provider.get(ViewModel::class.java)`를 호출하면 뷰모델 인스턴스를 반환한다.
  - 액티비티 인스턴스가 뷰모델 프로바이더에 뷰모델을 처음 요청하면 새로운 뷰모델 인스턴스를 생성하여 반환한다.
    - 장치 구성이 변경되어 새로운 액티비티 인스턴스가 뷰모델을 다시 요청하면 최초 생성되었던 인스턴스가 반환된다.
  - 액티비티 인스턴스가 destroyed 되면 뷰모델 인스턴스도 같이 메모리에서 제거된다.


- 뷰모델의 생명주기
  - 액티비티가 종료된다는 것은 해당 UI가 더 이상 필요하지 않다는 것이다. 
  - 장치 회전시에는 UI가 이전과 같을 필요가 있다.
  - `Activity.isFinishing` 속성으로 판단할 수 있다.
    - 뷰모델 인스턴스는 액티비티 생명주기와 연동된다.


- 뷰모델은 자신과 연관된 화면에서 필요한 모든 데이터를 저장하고 형식화 한다.
  - 프레젠테이션 로직 코드를 액티비티와 분리할 수 있다.
  - 액티비티는 최대한 간단하게 유지하는 것이 좋다.
    - 화면에 나타나는 것만 처리하게 집중
    - 데이터를 처리하는 내부 로직은 신경쓰지 않도록


- 프로세스 종료 시에 데이터 보존하기
  - SIS (Saved Instance State) 사용
  - 안드로이드 운영체제가 일시적으로 액티비티 외부에 저장하는 데이터
  - `onSaveInstanceState(Bundle)`을 오버라이드해서 SIS에 데이터를 추가할 수 있다.
  - 액티비티가 stopped 상태가 될때, 안드로이드 운영체제가 `onSaveInstanceState()`를 호출한다.
  - 액티비티의 부모클래스에 구현된 `onSaveInstanceState()`는 현재 액티비티의 모든 뷰의 상태를 Bundle 객체로 저장한다.
    - Bundle은 문자열 키와 키의 값을 쌍으로 갖는다.


- 액티비티 레코드
  - `onSaveInstanceState()`로 저장된 Bundle 객체는 액티비티 레코드로 저장된다.
  - 액티비티가 보존(stashed) 상태이면 액티비티 레코드 객체는 안드로이드 운영체제에 살아있다. 
  - 액티비티 레코드는 액티비티가 종료되면 같이 소멸된다.
  - Q
    - 프로세스 종료 시 상태를 보존하려고 SIS를 사용하는데, 프로세스 종료시에 액티비티 레코드가 소멸되는거면 저장이 안되는 거 아닌가
    - 